import express from 'express';
const app = express();
const port = 3000;
const __dirname = import.meta.dirname;
import {listeEleves} from "./sources/eleves.mjs";

app.get('/api/lesEleves', (requete, resultat, suivant) => {
    resultat.json(listeEleves) ;
})

app.get('/api/uneleve/:nom', (requete, resultat, suivant)=> {
   /* const eleve = requete.params.nom
    console.log(eleve)
    resultat.send('Eleve:'+eleve) */

    const {nom} = requete.params

    /*
    console.log(nom)
    resultat.send('Eleve:'+nom)

     */

    const eleveTrouve = listeEleves.find(unEleve =>
    unEleve.nom.toLowerCase() === nom.toLowerCase()
    )

    if (eleveTrouve) resultat.json(eleveTrouve)
    else {resultat.status(404).send(`Eleve ${nom} non présent dans nos bases`)}


})
app.get('/api/chercheeleve/:nom', (requete, resultat, suivant)=> {
    /* const eleve = requete.params.nom
     console.log(eleve)
     resultat.send('Eleve:'+eleve) */

    const {nom} = requete.params

    /*
    console.log(nom)
    resultat.send('Eleve:'+nom)

     */

    const eleveTrouve = listeEleves.find(unEleve =>
        unEleve.nom.toLowerCase().includes(nom.toLowerCase())
    )

    if (eleveTrouve) resultat.json(eleveTrouve)
    else {resultat.status(404).send(`Eleve ${nom} non présent dans nos bases`)}


})

app.get('/chercheParNomEtPrenom/:nomEleve/:prenomEleve', (req, res, suivant) => {
    const { nomEleve, prenomEleve } = req.params;

    const trouve = listeEleves.find(eleve =>
        eleve.nom.toLowerCase() === nomEleve.toLowerCase() &&
        eleve.prenom.toLowerCase() === prenomEleve.toLowerCase()
    );

    if (trouve) {
        res.json(trouve);
    } else {
        res.status(404).send('Correspondance non trouvée');
    }
});

app.get('/cherche', (requete, resultat, suivant) => {

    const nomEleve = requete.query.nom
    const prenomEleve = requete.query.prenom


    const trouve = listeEleves.find(eleve =>
        eleve.nom.toLowerCase() === nomEleve.toLowerCase() &&
        eleve.prenom.toLowerCase() === prenomEleve.toLowerCase()
    );

    if (trouve) {
        resultat.json(trouve);
    } else {
        resultat.status(404).send('Correspondance non trouvée');
    }
});

app.listen(port, () => {
    console.log(`Serveur démarré sur http://localhost:${port}`);
});